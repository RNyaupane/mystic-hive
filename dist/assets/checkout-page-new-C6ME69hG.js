import{x as u,R as d,j as r,u as Y,r as w,y as R,p as K}from"./index-BP-RX_Oe.js";import{p as Ce}from"./profileApi-BYtTgiFM.js";var ne="https://js.stripe.com/v3",Se=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,G="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Ee=function(){for(var e=document.querySelectorAll('script[src^="'.concat(ne,'"]')),t=0;t<e.length;t++){var s=e[t];if(Se.test(s.src))return s}return null},J=function(e){var t="",s=document.createElement("script");s.src="".concat(ne).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(s),s},Ne=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.5.0",startTime:t})},A=null,F=null,I=null,we=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},ke=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Pe=function(e){return A!==null?A:(A=new Promise(function(t,s){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(G),window.Stripe){t(window.Stripe);return}try{var a=Ee();if(a&&e)console.warn(G);else if(!a)a=J(e);else if(a&&I!==null&&F!==null){var o;a.removeEventListener("load",I),a.removeEventListener("error",F),(o=a.parentNode)===null||o===void 0||o.removeChild(a),a=J(e)}I=ke(t,s),F=we(s),a.addEventListener("load",I),a.addEventListener("error",F)}catch(l){s(l);return}}),A.catch(function(t){return A=null,Promise.reject(t)}))},Ae=function(e,t,s){if(e===null)return null;var a=e.apply(void 0,t);return Ne(a,s),a},O,se=!1,ae=function(){return O||(O=Pe(null).catch(function(e){return O=null,Promise.reject(e)}),O)};Promise.resolve().then(function(){return ae()}).catch(function(n){se||console.warn(n)});var Oe=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];se=!0;var a=Date.now();return ae().then(function(o){return Ae(o,t,a)})};function X(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(n,a).enumerable})),t.push.apply(t,s)}return t}function H(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?X(Object(t),!0).forEach(function(s){oe(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):X(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function M(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?M=function(e){return typeof e}:M=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(n)}function oe(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ie(n,e){return Re(n)||Le(n,e)||Te(n,e)||_e()}function Re(n){if(Array.isArray(n))return n}function Le(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var s=[],a=!0,o=!1,l,c;try{for(t=t.call(n);!(a=(l=t.next()).done)&&(s.push(l.value),!(e&&s.length===e));a=!0);}catch(i){o=!0,c=i}finally{try{!a&&t.return!=null&&t.return()}finally{if(o)throw c}}return s}}function Te(n,e){if(n){if(typeof n=="string")return Q(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Q(n,e)}}function Q(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function _e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var j=function(e,t,s){var a=!!s,o=d.useRef(s);d.useEffect(function(){o.current=s},[s]),d.useEffect(function(){if(!a||!e)return function(){};var l=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,l),function(){e.off(t,l)}},[a,t,e,o])},B=function(e){var t=d.useRef(e);return d.useEffect(function(){t.current=e},[e]),t.current},P=function(e){return e!==null&&M(e)==="object"},Fe=function(e){return P(e)&&typeof e.then=="function"},Ie=function(e){return P(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},Z="[object Object]",Me=function n(e,t){if(!P(e)||!P(t))return e===t;var s=Array.isArray(e),a=Array.isArray(t);if(s!==a)return!1;var o=Object.prototype.toString.call(e)===Z,l=Object.prototype.toString.call(t)===Z;if(o!==l)return!1;if(!o&&!s)return e===t;var c=Object.keys(e),i=Object.keys(t);if(c.length!==i.length)return!1;for(var y={},v=0;v<c.length;v+=1)y[c[v]]=!0;for(var g=0;g<i.length;g+=1)y[i[g]]=!0;var h=Object.keys(y);if(h.length!==c.length)return!1;var b=e,S=t,E=function(k){return n(b[k],S[k])};return h.every(E)},ce=function(e,t,s){return P(e)?Object.keys(e).reduce(function(a,o){var l=!P(t)||!Me(e[o],t[o]);return s.includes(o)?(l&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):l?H(H({},a||{}),{},oe({},o,e[o])):a},null):null},le="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ee=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:le;if(e===null||Ie(e))return e;throw new Error(t)},Ue=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:le;if(Fe(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(a){return ee(a,t)})};var s=ee(e,t);return s===null?{tag:"empty"}:{tag:"sync",stripe:s}},We=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"3.1.0"}),e.registerAppInfo({name:"react-stripe-js",version:"3.1.0",url:"https://stripe.com/docs/stripe-js/react"}))},U=d.createContext(null);U.displayName="ElementsContext";var de=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},D=function(e){var t=e.stripe,s=e.options,a=e.children,o=d.useMemo(function(){return Ue(t)},[t]),l=d.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(s):null}}),c=ie(l,2),i=c[0],y=c[1];d.useEffect(function(){var h=!0,b=function(E){y(function(p){return p.stripe?p:{stripe:E,elements:E.elements(s)}})};return o.tag==="async"&&!i.stripe?o.stripePromise.then(function(S){S&&h&&b(S)}):o.tag==="sync"&&!i.stripe&&b(o.stripe),function(){h=!1}},[o,i,s]);var v=B(t);d.useEffect(function(){v!==null&&v!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[v,t]);var g=B(s);return d.useEffect(function(){if(i.elements){var h=ce(s,g,["clientSecret","fonts"]);h&&i.elements.update(h)}},[s,g,i.elements]),d.useEffect(function(){We(i.stripe)},[i.stripe]),d.createElement(U.Provider,{value:i},a)};D.propTypes={stripe:u.any,options:u.object};var $e=function(e){var t=d.useContext(U);return de(t,e)},Be=function(){var e=$e("calls useElements()"),t=e.elements;return t};u.func.isRequired;var ue=d.createContext(null);ue.displayName="CheckoutSdkContext";var De=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},qe=d.createContext(null);qe.displayName="CheckoutContext";u.any,u.shape({clientSecret:u.string.isRequired,elementsOptions:u.object}).isRequired;var q=function(e){var t=d.useContext(ue),s=d.useContext(U);if(t&&s)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?De(t,e):de(s,e)},Ye=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e,t){var s="".concat(Ye(e),"Element"),a=function(i){var y=i.id,v=i.className,g=i.options,h=g===void 0?{}:g,b=i.onBlur,S=i.onFocus,E=i.onReady,p=i.onChange,k=i.onEscape,pe=i.onClick,fe=i.onLoadError,me=i.onLoaderStart,he=i.onNetworksChange,ve=i.onConfirm,ye=i.onCancel,xe=i.onShippingAddressChange,ge=i.onShippingRateChange,L=q("mounts <".concat(s,">")),T="elements"in L?L.elements:null,_="checkoutSdk"in L?L.checkoutSdk:null,je=d.useState(null),V=ie(je,2),x=V[0],be=V[1],N=d.useRef(null),W=d.useRef(null);j(x,"blur",b),j(x,"focus",S),j(x,"escape",k),j(x,"click",pe),j(x,"loaderror",fe),j(x,"loaderstart",me),j(x,"networkschange",he),j(x,"confirm",ve),j(x,"cancel",ye),j(x,"shippingaddresschange",xe),j(x,"shippingratechange",ge),j(x,"change",p);var $;E&&(e==="expressCheckout"?$=E:$=function(){E(x)}),j(x,"ready",$),d.useLayoutEffect(function(){if(N.current===null&&W.current!==null&&(T||_)){var C=null;_?C=_.createElement(e,h):T&&(C=T.create(e,h)),N.current=C,be(C),C&&C.mount(W.current)}},[T,_,h]);var z=B(h);return d.useEffect(function(){if(N.current){var C=ce(h,z,["paymentRequest"]);C&&"update"in N.current&&N.current.update(C)}},[h,z]),d.useLayoutEffect(function(){return function(){if(N.current&&typeof N.current.destroy=="function")try{N.current.destroy(),N.current=null}catch{}}},[]),d.createElement("div",{id:y,className:v,ref:W})},o=function(i){q("mounts <".concat(s,">"));var y=i.id,v=i.className;return d.createElement("div",{id:y,className:v})},l=t?o:a;return l.propTypes={id:u.string,className:u.string,onChange:u.func,onBlur:u.func,onFocus:u.func,onReady:u.func,onEscape:u.func,onClick:u.func,onLoadError:u.func,onLoaderStart:u.func,onNetworksChange:u.func,onConfirm:u.func,onCancel:u.func,onShippingAddressChange:u.func,onShippingRateChange:u.func,options:u.object},l.displayName=s,l.__elementType=e,l},m=typeof window>"u",Ve=d.createContext(null);Ve.displayName="EmbeddedCheckoutProviderContext";var ze=function(){var e=q("calls useStripe()"),t=e.stripe;return t};f("auBankAccount",m);var te=f("card",m);f("cardNumber",m);f("cardExpiry",m);f("cardCvc",m);f("fpxBank",m);f("iban",m);f("idealBank",m);f("p24Bank",m);f("epsBank",m);f("payment",m);f("expressCheckout",m);f("currencySelector",m);f("paymentRequestButton",m);f("linkAuthentication",m);f("address",m);f("shippingAddress",m);f("paymentMethodMessaging",m);f("affirmMessage",m);f("afterpayClearpayMessage",m);const Ke=({address:n=[],addLoad:e=!1,activeAccordion:t,toggleAccordion:s,isNewAdd:a,setIsNewAdd:o,setSelectedAddress:l})=>r.jsx("div",{className:"caupon-wrap s2",children:r.jsxs("div",{className:"biling-item",children:[r.jsx("div",{className:`coupon coupon-3 ${t.address?"accordian-border-top":" accordian-border-left "}`,onClick:()=>s("address"),children:r.jsx("label",{id:"toggle2",children:"Billing Address"})}),t.address&&r.jsxs("div",{className:"billing-adress",id:"open2",children:[r.jsx("div",{className:"contact-form form-style",children:r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-lg-12 col-md-12 col-12",children:[e?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm mx-2",role:"status","aria-hidden":"true"}),r.jsx("label",{htmlFor:"Country",children:"Loading Address"})]}):r.jsx("label",{htmlFor:"Country",children:"Select Your Address"}),r.jsxs("select",{name:"address",id:"address",defaultValue:0,onChange:c=>l(c.target.value),className:"form-control",children:[r.jsx("option",{disabled:!0,value:0,children:"Select Address"}),!e&&n.length>0?n==null?void 0:n.map((c,i)=>r.jsx("option",{className:"py-4 my-3",value:c==null?void 0:c.id,children:`${c.address_line1}, ${c.address_line2?c.address_line2+", ":""}${c.city}, ${c.state}, ${c.country} - ${c.postal_code}`},i)):r.jsx("option",{children:"No Address"})]})]})})}),r.jsxs("div",{className:"biling-item-2",children:[r.jsx("input",{id:"toggle3",type:"checkbox",checked:a,onChange:()=>{},onClick:()=>o(!a)}),r.jsx("label",{className:"fontsize ps-2 cursor-pointer",htmlFor:"toggle3",children:"Ship to a different address?"}),a&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"billing-adress",children:r.jsx("div",{className:"contact-form form-style",children:r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"Country",children:"Country"}),r.jsxs("select",{name:"address",id:"Country",className:"form-control",children:[r.jsx("option",{disabled:"",children:"United State"}),r.jsx("option",{children:"Bangladesh"}),r.jsx("option",{children:"India"}),r.jsx("option",{children:"Srilanka"}),r.jsx("option",{children:"Pakisthan"}),r.jsx("option",{children:"Afgansthan"})]})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"district",children:"Dristrict"}),r.jsx("input",{type:"text",placeholder:"",id:"district",name:"district"})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"postalCode",children:"Post Code"}),r.jsx("input",{type:"text",placeholder:"",id:"postalCode",name:"postalCode"})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"city",children:"City"}),r.jsx("input",{type:"text",placeholder:"",id:"city",name:"city"})]})]})})}),r.jsx("div",{className:"submit-btn-area",children:r.jsx("ul",{children:r.jsx("li",{children:r.jsx("button",{className:"btn btn-dark rounded-0",type:"button",onClick:()=>s("payment"),children:"Save & continue"})})})})]})]})]})]})}),Ge=()=>{const{items:n}=Y(l=>l.cart),e=n.reduce((l,c)=>l+parseFloat(c.sub_total),0),t=e*.1,s=100,a=100,o=e+t+s-a;return r.jsx("div",{className:"col-lg-4 col-12",children:r.jsx("div",{className:"cout-order-area",children:r.jsx("div",{className:"oreder-item",children:r.jsxs("ul",{children:[r.jsxs("li",{className:"o-header",children:["Your Order",r.jsxs("span",{children:["(",n.length,")"]})]}),n.map((l,c)=>r.jsxs("li",{children:[l.product.name," X ",l.quantity,r.jsx("span",{children:parseFloat(l.sub_total).toFixed(2)})]},c)),r.jsxs("li",{className:"s-total",children:["Sub Total",r.jsx("span",{children:e.toFixed(2)})]}),r.jsxs("li",{children:["( + ) VAT",r.jsx("span",{children:t.toFixed(2)})]}),r.jsxs("li",{children:["( + ) Eco Tax",r.jsx("span",{children:s.toFixed(2)})]}),r.jsxs("li",{children:["( - ) Discount Price",r.jsx("span",{children:a.toFixed(2)})]}),r.jsxs("li",{className:"o-bottom",children:["Total price",r.jsx("span",{children:o.toFixed(2)})]})]})})})})},Je={style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"},padding:"10px",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#fff"},invalid:{color:"#9e2146"}}},Xe=({selectedAddress:n})=>{const e=ze(),t=Be(),s=Y(c=>c.cart.id),[a,o]=w.useState(!1),l=async c=>{if(c.preventDefault(),!n){R.warn("Please select an address");return}if(!e||!t){R.error("Stripe is not loaded");return}o(!0);try{const i=await K.orderPlace({cart_id:s,address_id:n});if(!i.ok)throw new Error("Order placement failed");const v=(await i.json()).id,g=t.getElement(te),{paymentMethod:h,error:b}=await e.createPaymentMethod({type:"card",card:g});if(b)throw new Error(b.message);if(!(await K.processPayment({order:v,payment_method:"STRIPE",amount:639,stripe_payment_method:h.id})).ok)throw new Error("Payment failed");R.success("Payment successful!")}catch(i){R.error(i.message)}o(!1)};return r.jsxs("form",{onSubmit:l,className:"stripe-form w-100",children:[r.jsx("div",{className:"d-flex w-100",children:r.jsx("img",{src:"assets/img/stripe.png",className:"m-auto",alt:"",style:{maxWidth:"70px"}})}),r.jsx("div",{className:"stripe-card-container",children:r.jsx(te,{options:Je,className:"stripe-card"})}),r.jsx("button",{type:"submit",disabled:!e||a,className:"theme-btn mt-3",children:a?"Processing...":"Pay with Stripe"})]})},re=Oe("your-publishable-key-here"),Ze=()=>{const[n,e]=w.useState({address:!0,payment:!1}),t=Y(p=>p.cart.id),[s,a]=w.useState([]),[o,l]=w.useState(),[c,i]=w.useState(!1),[y,v]=w.useState("stripe"),[g,h]=w.useState(!1),b=p=>{e(k=>({...k,[p]:!k[p]}))},S=async()=>{i(!0);try{const p=await Ce.getAddress();a(p==null?void 0:p.data)}catch(p){console.warn(p)}finally{i(!1)}};w.useEffect(()=>{S()},[]);const E=p=>{p.preventDefault(),o?console.log({cart_id:t,address_id:o}):R.warn("Please select an address")};return r.jsx(D,{stripe:re,children:r.jsx("div",{className:"checkout-area section-padding",children:r.jsx("div",{className:"container",children:r.jsx("form",{children:r.jsx("div",{className:"checkout-wrap",children:r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-lg-8 col-12",children:[r.jsx(Ke,{address:s,addLoad:c,activeAccordion:n,toggleAccordion:b,isNewAdd:g,setIsNewAdd:h,setSelectedAddress:l}),r.jsx("div",{className:"caupon-wrap s3",children:r.jsx("div",{className:"payment-area",children:r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-12",children:[r.jsx("div",{className:`coupon coupon-3 ${n.payment?"accordian-border-top":" accordian-border-left "} `,onClick:()=>b("payment"),children:r.jsx("label",{id:"toggle4",children:"Payment Method"})}),n.payment&&r.jsxs("div",{className:"payment-option",children:[r.jsx("div",{className:"payment-select",children:r.jsxs("ul",{children:[r.jsxs("li",{className:"addToggle",children:[r.jsx("input",{id:"stripe",type:"radio",checked:y==="stripe",onChange:()=>v("stripe")}),r.jsx("label",{htmlFor:"stripe",className:"ps-2 me-4 cursor-pointer",children:"Payment By Stripe"})]}),r.jsxs("li",{className:"removeToggle",children:[r.jsx("input",{id:"cash",type:"radio",checked:y==="cash",onChange:()=>v("cash")}),r.jsx("label",{htmlFor:"cash",className:"ps-2 cursor-pointer",children:"Cash On delivery"})]})]})}),y==="stripe"&&r.jsx(D,{stripe:re,children:r.jsx(Xe,{selectedAddress:o,cartId:t})}),y==="cash"&&r.jsx("div",{className:"contact-form form-style",children:r.jsx("div",{className:"row",children:r.jsx("div",{className:"col-lg-12 col-md-12 col-12",children:r.jsx("div",{className:"submit-btn-area text-center",children:r.jsx("button",{className:"theme-btn px-5",type:"submit",onClick:p=>E(p),children:"Place Order"})})})})})]})]})})})})]}),r.jsx(Ge,{})]})})})})})})};export{Ze as default};
