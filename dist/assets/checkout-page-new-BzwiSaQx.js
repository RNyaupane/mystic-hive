import{R as d,A as p,j as r,u as re,r as P,b as pe,y as T,p as Y,B as me,v as Ee}from"./index-Dtn4P0od.js";import{p as Ne}from"./profileApi-DBSGrQRk.js";var fe="https://js.stripe.com/v3",we=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var Pe=function(){for(var e=document.querySelectorAll('script[src^="'.concat(fe,'"]')),t=0;t<e.length;t++){var a=e[t];if(we.test(a.src))return a}return null},ae=function(e){var t="",a=document.createElement("script");a.src="".concat(fe).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(a),a},ke=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.6.0",startTime:t})},L=null,q=null,K=null,Ae=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Oe=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Re=function(e){return L!==null?L:(L=new Promise(function(t,a){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var s=Pe();if(!(s&&e)){if(!s)s=ae(e);else if(s&&K!==null&&q!==null){var c;s.removeEventListener("load",K),s.removeEventListener("error",q),(c=s.parentNode)===null||c===void 0||c.removeChild(s),s=ae(e)}}K=Oe(t,a),q=Ae(a),s.addEventListener("load",K),s.addEventListener("error",q)}catch(u){a(u);return}}),L.catch(function(t){return L=null,Promise.reject(t)}))},Te=function(e,t,a){if(e===null)return null;var s=e.apply(void 0,t);return ke(s,a),s},I,he=!1,ve=function(){return I||(I=Re(null).catch(function(e){return I=null,Promise.reject(e)}),I)};Promise.resolve().then(function(){return ve()}).catch(function(n){he||console.warn(n)});var _e=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];he=!0;var s=Date.now();return ve().then(function(c){return Te(c,t,s)})};function se(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,a)}return t}function oe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?se(Object(t),!0).forEach(function(a){ye(n,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):se(Object(t)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(t,a))})}return n}function D(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?D=function(e){return typeof e}:D=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(n)}function ye(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function xe(n,e){return Fe(n)||Le(n,e)||Ie(n,e)||Be()}function Fe(n){if(Array.isArray(n))return n}function Le(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var a=[],s=!0,c=!1,u,l;try{for(t=t.call(n);!(s=(u=t.next()).done)&&(a.push(u.value),!(e&&a.length===e));s=!0);}catch(i){c=!0,l=i}finally{try{!s&&t.return!=null&&t.return()}finally{if(c)throw l}}return a}}function Ie(n,e){if(n){if(typeof n=="string")return ce(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ce(n,e)}}function ce(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=n[t];return a}function Be(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var b=function(e,t,a){var s=!!a,c=d.useRef(a);d.useEffect(function(){c.current=a},[a]),d.useEffect(function(){if(!s||!e)return function(){};var u=function(){c.current&&c.current.apply(c,arguments)};return e.on(t,u),function(){e.off(t,u)}},[s,t,e,c])},Z=function(e){var t=d.useRef(e);return d.useEffect(function(){t.current=e},[e]),t.current},F=function(e){return e!==null&&D(e)==="object"},Me=function(e){return F(e)&&typeof e.then=="function"},Ue=function(e){return F(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ie="[object Object]",We=function n(e,t){if(!F(e)||!F(t))return e===t;var a=Array.isArray(e),s=Array.isArray(t);if(a!==s)return!1;var c=Object.prototype.toString.call(e)===ie,u=Object.prototype.toString.call(t)===ie;if(c!==u)return!1;if(!c&&!a)return e===t;var l=Object.keys(e),i=Object.keys(t);if(l.length!==i.length)return!1;for(var v={},m=0;m<l.length;m+=1)v[l[m]]=!0;for(var y=0;y<i.length;y+=1)v[i[y]]=!0;var o=Object.keys(v);if(o.length!==l.length)return!1;var g=e,S=t,w=function(_){return n(g[_],S[_])};return o.every(w)},ge=function(e,t,a){return F(e)?Object.keys(e).reduce(function(s,c){var u=!F(t)||!We(e[c],t[c]);return a.includes(c)?(u&&console.warn("Unsupported prop change: options.".concat(c," is not a mutable property.")),s):u?oe(oe({},s||{}),{},ye({},c,e[c])):s},null):null},je="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",le=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:je;if(e===null||Ue(e))return e;throw new Error(t)},$e=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:je;if(Me(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(s){return le(s,t)})};var a=le(e,t);return a===null?{tag:"empty"}:{tag:"sync",stripe:a}},qe=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"3.1.0"}),e.registerAppInfo({name:"react-stripe-js",version:"3.1.0",url:"https://stripe.com/docs/stripe-js/react"}))},G=d.createContext(null);G.displayName="ElementsContext";var Ce=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},ee=function(e){var t=e.stripe,a=e.options,s=e.children,c=d.useMemo(function(){return $e(t)},[t]),u=d.useState(function(){return{stripe:c.tag==="sync"?c.stripe:null,elements:c.tag==="sync"?c.stripe.elements(a):null}}),l=xe(u,2),i=l[0],v=l[1];d.useEffect(function(){var o=!0,g=function(w){v(function(A){return A.stripe?A:{stripe:w,elements:w.elements(a)}})};return c.tag==="async"&&!i.stripe?c.stripePromise.then(function(S){S&&o&&g(S)}):c.tag==="sync"&&!i.stripe&&g(c.stripe),function(){o=!1}},[c,i,a]);var m=Z(t);d.useEffect(function(){m!==null&&m!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[m,t]);var y=Z(a);return d.useEffect(function(){if(i.elements){var o=ge(a,y,["clientSecret","fonts"]);o&&i.elements.update(o)}},[a,y,i.elements]),d.useEffect(function(){qe(i.stripe)},[i.stripe]),d.createElement(G.Provider,{value:i},s)};ee.propTypes={stripe:p.any,options:p.object};var Ke=function(e){var t=d.useContext(G);return Ce(t,e)},De=function(){var e=Ke("calls useElements()"),t=e.elements;return t};p.func.isRequired;var Se=d.createContext(null);Se.displayName="CheckoutSdkContext";var Ye=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},Ge=d.createContext(null);Ge.displayName="CheckoutContext";p.any,p.shape({clientSecret:p.string.isRequired,elementsOptions:p.object}).isRequired;var te=function(e){var t=d.useContext(Se),a=d.useContext(G);if(t&&a)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Ye(t,e):Ce(a,e)},Je=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e,t){var a="".concat(Je(e),"Element"),s=function(i){var v=i.id,m=i.className,y=i.options,o=y===void 0?{}:y,g=i.onBlur,S=i.onFocus,w=i.onReady,A=i.onChange,_=i.onEscape,J=i.onClick,j=i.onLoadError,O=i.onLoaderStart,B=i.onNetworksChange,M=i.onConfirm,U=i.onCancel,W=i.onShippingAddressChange,$=i.onShippingRateChange,R=te("mounts <".concat(a,">")),C="elements"in R?R.elements:null,E="checkoutSdk"in R?R.checkoutSdk:null,V=d.useState(null),H=xe(V,2),x=H[0],be=H[1],k=d.useRef(null),z=d.useRef(null);b(x,"blur",g),b(x,"focus",S),b(x,"escape",_),b(x,"click",J),b(x,"loaderror",j),b(x,"loaderstart",O),b(x,"networkschange",B),b(x,"confirm",M),b(x,"cancel",U),b(x,"shippingaddresschange",W),b(x,"shippingratechange",$),b(x,"change",A);var X;w&&(e==="expressCheckout"?X=w:X=function(){w(x)}),b(x,"ready",X),d.useLayoutEffect(function(){if(k.current===null&&z.current!==null&&(C||E)){var N=null;E?N=E.createElement(e,o):C&&(N=C.create(e,o)),k.current=N,be(N),N&&N.mount(z.current)}},[C,E,o]);var ne=Z(o);return d.useEffect(function(){if(k.current){var N=ge(o,ne,["paymentRequest"]);N&&"update"in k.current&&k.current.update(N)}},[o,ne]),d.useLayoutEffect(function(){return function(){if(k.current&&typeof k.current.destroy=="function")try{k.current.destroy(),k.current=null}catch{}}},[]),d.createElement("div",{id:v,className:m,ref:z})},c=function(i){te("mounts <".concat(a,">"));var v=i.id,m=i.className;return d.createElement("div",{id:v,className:m})},u=t?c:s;return u.propTypes={id:p.string,className:p.string,onChange:p.func,onBlur:p.func,onFocus:p.func,onReady:p.func,onEscape:p.func,onClick:p.func,onLoadError:p.func,onLoaderStart:p.func,onNetworksChange:p.func,onConfirm:p.func,onCancel:p.func,onShippingAddressChange:p.func,onShippingRateChange:p.func,options:p.object},u.displayName=a,u.__elementType=e,u},h=typeof window>"u",Ve=d.createContext(null);Ve.displayName="EmbeddedCheckoutProviderContext";var He=function(){var e=te("calls useStripe()"),t=e.stripe;return t};f("auBankAccount",h);f("card",h);var ue=f("cardNumber",h),ze=f("cardExpiry",h),Xe=f("cardCvc",h);f("fpxBank",h);f("iban",h);f("idealBank",h);f("p24Bank",h);f("epsBank",h);f("payment",h);f("expressCheckout",h);f("currencySelector",h);f("paymentRequestButton",h);f("linkAuthentication",h);f("address",h);f("shippingAddress",h);f("paymentMethodMessaging",h);f("affirmMessage",h);f("afterpayClearpayMessage",h);const Qe=["Nepal","India","USA"],Ze={Nepal:["Bagmati","Gandaki","Karnali"],India:["Maharashtra","Karnataka","Tamil Nadu"],USA:["California","Texas","New York"]},et={Bagmati:["Kathmandu","Lalitpur","Bhaktapur"],Gandaki:["Pokhara","Gorkha","Lamjung"],Karnali:["Surkhet","Jumla","Dolpa"],Maharashtra:["Mumbai","Pune","Nagpur"],Karnataka:["Bangalore","Mysore","Hubli"],"Tamil Nadu":["Chennai","Coimbatore","Madurai"],California:["Los Angeles","San Francisco","San Diego"],Texas:["Houston","Dallas","Austin"],"New York":["New York City","Buffalo","Rochester"]},tt=({address:n=[],addLoad:e=!1,activeAccordion:t,toggleAccordion:a,isNewAdd:s,setIsNewAdd:c,setSelectedAddress:u,formData:l,setFormData:i})=>{const v=o=>{const{name:g,value:S}=o.target;i({...l,[g]:S})},m=l.country?Ze[l.country]:[],y=l.state?et[l.state]:[];return r.jsx("div",{className:"caupon-wrap s2",children:r.jsxs("div",{className:"biling-item",children:[r.jsx("div",{className:`coupon coupon-3 ${t.address?"accordian-border-top":" accordian-border-left "}`,onClick:()=>a("address"),children:r.jsx("label",{id:"toggle2",children:"Billing Address"})}),t.address&&r.jsxs("div",{className:"billing-adress",id:"open2",children:[r.jsx("div",{className:"contact-form form-style",children:r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-lg-12 col-md-12 col-12",children:[e?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"spinner-border spinner-border-sm mx-2",role:"status","aria-hidden":"true"}),r.jsx("label",{htmlFor:"Country",children:"Loading Address"})]}):r.jsx("label",{htmlFor:"Country",children:"Select Your Address"}),r.jsxs("select",{name:"address",id:"address",defaultValue:0,onChange:o=>{u(o.target.value),c(!1)},className:"form-control",children:[r.jsx("option",{disabled:!0,value:0,children:"Select Address"}),!e&&n.length>0?n==null?void 0:n.map((o,g)=>r.jsx("option",{className:"py-4 my-3",value:o==null?void 0:o.id,children:`${o.address_line1}, ${o.address_line2?o.address_line2+", ":""}${o.city}, ${o.state}, ${o.country} - ${o.postal_code}`},g)):r.jsx("option",{children:"No Address"})]})]})})}),r.jsxs("div",{className:"biling-item-2",children:[r.jsx("input",{id:"toggle3",type:"checkbox",checked:s,onChange:()=>{},onClick:()=>c(!s)}),r.jsx("label",{className:"fontsize ps-2 cursor-pointer",htmlFor:"toggle3",children:"Ship to a different address?"}),s&&r.jsx(r.Fragment,{children:r.jsx("div",{className:"billing-adress",children:r.jsx("div",{className:"contact-form form-style",children:r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"Country",children:"Country"}),r.jsx("select",{name:"country",value:l.country,onChange:v,className:"form-control",children:Qe.map(o=>r.jsx("option",{value:o,children:o},o))})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"Country",children:"State"}),r.jsx("select",{name:"state",value:l.state,onChange:v,className:"form-control",disabled:!l.country,children:m.map(o=>r.jsx("option",{value:o,children:o},o))})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"Country",children:"City"}),r.jsx("select",{name:"city",value:l.city,onChange:v,className:"form-control",disabled:!l.country,children:y.map(o=>r.jsx("option",{value:o,children:o},o))})]}),r.jsxs("div",{className:"col-lg-6 col-md-12 col-12",children:[r.jsx("label",{htmlFor:"postalCode",children:"Post Code"}),r.jsx("input",{name:"postal_code",value:l.postal_code,onChange:v,placeholder:"Enter Postal Code...",type:"number"})]})]})})})})]})]})]})})},rt=()=>{const{items:n}=re(u=>u.cart),e=n.reduce((u,l)=>u+parseFloat(l.sub_total),0),t=e*.1,a=100,s=100,c=e+t+a-s;return r.jsx("div",{className:"col-lg-4 col-12",children:r.jsx("div",{className:"cout-order-area",children:r.jsx("div",{className:"oreder-item",children:r.jsxs("ul",{children:[r.jsxs("li",{className:"o-header",children:["Your Order",r.jsxs("span",{children:["(",n.length,")"]})]}),n.map((u,l)=>r.jsxs("li",{children:[u.product.name," X ",u.quantity,r.jsx("span",{children:parseFloat(u.sub_total).toFixed(2)})]},l)),r.jsxs("li",{className:"s-total",children:["Sub Total",r.jsx("span",{children:e.toFixed(2)})]}),r.jsxs("li",{children:["( + ) VAT",r.jsx("span",{children:t.toFixed(2)})]}),r.jsxs("li",{children:["( + ) Eco Tax",r.jsx("span",{children:a.toFixed(2)})]}),r.jsxs("li",{children:["( - ) Discount Price",r.jsx("span",{children:s.toFixed(2)})]}),r.jsxs("li",{className:"o-bottom",children:["Total price",r.jsx("span",{children:c.toFixed(2)})]})]})})})})},nt=()=>P.useMemo(()=>({style:{base:{color:"#424770",letterSpacing:"0.025em",fontFamily:"Source Code Pro, monospace","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),[]),Q={style:{base:{color:"#424770",letterSpacing:"0.025em",fontFamily:"Source Code Pro, monospace","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},at=({selectedAddress:n})=>{const e=He(),t=De(),a=re(i=>i.cart.id),[s,c]=P.useState(!1),u=pe();nt();const l=async i=>{var v;if(i.preventDefault(),!n){T.warn("Please select an address");return}if(!e||!t){T.error("Stripe is not loaded");return}c(!0);try{const m=await Y.orderPlace({cart_id:a,address_id:n});if(u(me()),!m)throw new Error("Order placement failed");const y=m.id,o=await Y.processPayment({order:y,payment_method:"STRIPE"});if(!((v=o==null?void 0:o.data)!=null&&v.client_secret))throw new Error("Payment processing failed");const{client_secret:g}=o.data,S=await e.confirmCardPayment(g,{payment_method:{card:t.getElement(ue)}});if(S.error)throw new Error(S.error.message);S.paymentIntent.status==="succeeded"&&T.success("Payment successful!")}catch(m){T.error(m.message)}c(!1)};return r.jsxs("form",{className:"stripe-form w-100",children:[r.jsx("div",{className:"d-flex w-100",children:r.jsx("img",{src:"assets/img/stripe.png",className:"m-auto",alt:"",style:{maxWidth:"70px"}})}),r.jsxs("label",{children:["Card Number",r.jsx(ue,{options:Q,className:"stripe-card"})]}),r.jsxs("label",{children:["Expiration Date",r.jsx(ze,{options:Q,className:"stripe-card"})]}),r.jsxs("label",{children:["Security Code",r.jsx(Xe,{options:Q,className:"stripe-card"})]}),r.jsx("button",{onClick:l,disabled:!e||s,className:"theme-btn mt-3",children:s?"Processing...":"Pay with Stripe"})]})},de=_e("pk_test_51PGk1E08B7UPR9midVhC2PlwAYdcEowjTvHEgJS12GRRiZIFq2D9rCzcKKa0xntvKTDDIt6DxtQP6Qyles7FKXQJ00WJYc7wA7"),ct=()=>{const[n,e]=P.useState({address:!0,payment:!1}),[t,a]=P.useState({city:"",state:"",postal_code:"",country:""}),s=re(j=>j.cart.id),[c,u]=P.useState([]),[l,i]=P.useState(),[v,m]=P.useState(!1),[y,o]=P.useState("stripe"),[g,S]=P.useState(!1),w=pe(),A=j=>{e(O=>({...O,[j]:!O[j]}))},_=async()=>{m(!0);try{const j=await Ne.getAddress();u(j==null?void 0:j.data)}catch(j){console.warn(j)}finally{m(!1)}};P.useEffect(()=>{_()},[]);const J=async j=>{var O,B,M,U,W,$,R;if(j.preventDefault(),!g&&!l){T.warn("Please select an address");return}else try{let C;if(g){const x=await Ee.post("auth/address/",{...t});C=(O=x==null?void 0:x.data)==null?void 0:O.id}else C=l;const E=await Y.orderPlace({cart_id:s,address_id:C});if(console.log(E),!(E!=null&&E.data))throw w(me()),new Error("Order placement failed");const V=(B=E==null?void 0:E.data)==null?void 0:B.id;await Y.processPayment({order:V,payment_method:"CASH"})&&T.success("Order Placed Successfully")}catch(C){console.warn(C),T.error(`Failed To place order${((U=(M=C==null?void 0:C.response)==null?void 0:M.data)==null?void 0:U.message)||((R=($=(W=C==null?void 0:C.response)==null?void 0:W.data)==null?void 0:$.message)==null?void 0:R[0])}`)}};return r.jsx(ee,{stripe:de,children:r.jsx("div",{className:"checkout-area section-padding",children:r.jsx("div",{className:"container",children:r.jsx("div",{className:"checkout-wrap",children:r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-lg-8 col-12",children:[r.jsx(tt,{address:c,addLoad:v,activeAccordion:n,toggleAccordion:A,isNewAdd:g,setIsNewAdd:S,setSelectedAddress:i,formData:t,setFormData:a}),r.jsx("div",{className:"caupon-wrap s3",children:r.jsx("div",{className:"payment-area",children:r.jsx("div",{className:"row",children:r.jsxs("div",{className:"col-12",children:[r.jsx("div",{className:`coupon coupon-3 ${n.payment?"accordian-border-top":" accordian-border-left "} `,onClick:()=>A("payment"),children:r.jsx("label",{id:"toggle4",children:"Payment Method"})}),n.payment&&r.jsxs("div",{className:"payment-option",children:[r.jsx("div",{className:"payment-select",children:r.jsxs("ul",{children:[r.jsxs("li",{className:"addToggle",children:[r.jsx("input",{id:"stripe",type:"radio",checked:y==="stripe",onChange:()=>o("stripe")}),r.jsx("label",{htmlFor:"stripe",className:"ps-2 me-4 cursor-pointer",children:"Payment By Stripe"})]}),r.jsxs("li",{className:"removeToggle",children:[r.jsx("input",{id:"cash",type:"radio",checked:y==="cash",onChange:()=>o("cash")}),r.jsx("label",{htmlFor:"cash",className:"ps-2 cursor-pointer",children:"Cash On delivery"})]})]})}),y==="stripe"&&r.jsx(ee,{stripe:de,children:r.jsx(at,{selectedAddress:l,cartId:s})}),y==="cash"&&r.jsx("div",{className:"contact-form form-style",children:r.jsx("div",{className:"row",children:r.jsx("div",{className:"col-lg-12 col-md-12 col-12",children:r.jsx("div",{className:"submit-btn-area text-center",children:r.jsx("button",{className:"theme-btn px-5",onClick:j=>J(j),children:"Place Order"})})})})})]})]})})})})]}),r.jsx(rt,{})]})})})})})};export{ct as default};
