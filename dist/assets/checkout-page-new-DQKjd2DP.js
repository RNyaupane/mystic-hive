import{R as l,A as p,u as re,j as a,r as N,b as pe,y as T,p as Y,B as fe,v as be}from"./index-CvIzpCtl.js";import{p as we}from"./profileApi-DgFhbuoh.js";var me="https://js.stripe.com/v3",Pe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var Ne=function(){for(var e=document.querySelectorAll('script[src^="'.concat(me,'"]')),t=0;t<e.length;t++){var n=e[t];if(Pe.test(n.src))return n}return null},ae=function(e){var t="",n=document.createElement("script");n.src="".concat(me).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},ke=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"5.6.0",startTime:t})},I=null,q=null,$=null,Ae=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Oe=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Re=function(e){return I!==null?I:(I=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var s=Ne();if(!(s&&e)){if(!s)s=ae(e);else if(s&&$!==null&&q!==null){var o;s.removeEventListener("load",$),s.removeEventListener("error",q),(o=s.parentNode)===null||o===void 0||o.removeChild(s),s=ae(e)}}$=Oe(t,n),q=Ae(n),s.addEventListener("load",$),s.addEventListener("error",q)}catch(c){n(c);return}}),I.catch(function(t){return I=null,Promise.reject(t)}))},Te=function(e,t,n){if(e===null)return null;var s=e.apply(void 0,t);return ke(s,n),s},F,he=!1,ve=function(){return F||(F=Re(null).catch(function(e){return F=null,Promise.reject(e)}),F)};Promise.resolve().then(function(){return ve()}).catch(function(r){he||console.warn(r)});var Le=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];he=!0;var s=Date.now();return ve().then(function(o){return Te(o,t,s)})};function se(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function oe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?se(Object(t),!0).forEach(function(n){ye(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):se(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function K(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?K=function(e){return typeof e}:K=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(r)}function ye(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ge(r,e){return _e(r)||Ie(r,e)||Fe(r,e)||De()}function _e(r){if(Array.isArray(r))return r}function Ie(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],s=!0,o=!1,c,u;try{for(t=t.call(r);!(s=(c=t.next()).done)&&(n.push(c.value),!(e&&n.length===e));s=!0);}catch(i){o=!0,u=i}finally{try{!s&&t.return!=null&&t.return()}finally{if(o)throw u}}return n}}function Fe(r,e){if(r){if(typeof r=="string")return ie(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ie(r,e)}}function ie(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function De(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var j=function(e,t,n){var s=!!n,o=l.useRef(n);l.useEffect(function(){o.current=n},[n]),l.useEffect(function(){if(!s||!e)return function(){};var c=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,c),function(){e.off(t,c)}},[s,t,e,o])},Z=function(e){var t=l.useRef(e);return l.useEffect(function(){t.current=e},[e]),t.current},_=function(e){return e!==null&&K(e)==="object"},We=function(e){return _(e)&&typeof e.then=="function"},Ue=function(e){return _(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ce="[object Object]",Me=function r(e,t){if(!_(e)||!_(t))return e===t;var n=Array.isArray(e),s=Array.isArray(t);if(n!==s)return!1;var o=Object.prototype.toString.call(e)===ce,c=Object.prototype.toString.call(t)===ce;if(o!==c)return!1;if(!o&&!n)return e===t;var u=Object.keys(e),i=Object.keys(t);if(u.length!==i.length)return!1;for(var S={},h=0;h<u.length;h+=1)S[u[h]]=!0;for(var y=0;y<i.length;y+=1)S[i[y]]=!0;var d=Object.keys(S);if(d.length!==u.length)return!1;var E=e,C=t,P=function(L){return r(E[L],C[L])};return d.every(P)},xe=function(e,t,n){return _(e)?Object.keys(e).reduce(function(s,o){var c=!_(t)||!Me(e[o],t[o]);return n.includes(o)?(c&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),s):c?oe(oe({},s||{}),{},ye({},o,e[o])):s},null):null},Se="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",le=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Se;if(e===null||Ue(e))return e;throw new Error(t)},Be=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Se;if(We(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(s){return le(s,t)})};var n=le(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},qe=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"3.1.0"}),e.registerAppInfo({name:"react-stripe-js",version:"3.1.0",url:"https://stripe.com/docs/stripe-js/react"}))},J=l.createContext(null);J.displayName="ElementsContext";var Ce=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},ee=function(e){var t=e.stripe,n=e.options,s=e.children,o=l.useMemo(function(){return Be(t)},[t]),c=l.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),u=ge(c,2),i=u[0],S=u[1];l.useEffect(function(){var d=!0,E=function(P){S(function(A){return A.stripe?A:{stripe:P,elements:P.elements(n)}})};return o.tag==="async"&&!i.stripe?o.stripePromise.then(function(C){C&&d&&E(C)}):o.tag==="sync"&&!i.stripe&&E(o.stripe),function(){d=!1}},[o,i,n]);var h=Z(t);l.useEffect(function(){h!==null&&h!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[h,t]);var y=Z(n);return l.useEffect(function(){if(i.elements){var d=xe(n,y,["clientSecret","fonts"]);d&&i.elements.update(d)}},[n,y,i.elements]),l.useEffect(function(){qe(i.stripe)},[i.stripe]),l.createElement(J.Provider,{value:i},s)};ee.propTypes={stripe:p.any,options:p.object};var $e=function(e){var t=l.useContext(J);return Ce(t,e)},Ke=function(){var e=$e("calls useElements()"),t=e.elements;return t};p.func.isRequired;var je=l.createContext(null);je.displayName="CheckoutSdkContext";var Ye=function(e,t){if(!e)throw new Error("Could not find CheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CheckoutProvider> provider."));return e},Je=l.createContext(null);Je.displayName="CheckoutContext";p.any,p.shape({clientSecret:p.string.isRequired,elementsOptions:p.object}).isRequired;var te=function(e){var t=l.useContext(je),n=l.useContext(J);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t?Ye(t,e):Ce(n,e)},Ge=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},f=function(e,t){var n="".concat(Ge(e),"Element"),s=function(i){var S=i.id,h=i.className,y=i.options,d=y===void 0?{}:y,E=i.onBlur,C=i.onFocus,P=i.onReady,A=i.onChange,L=i.onEscape,G=i.onClick,g=i.onLoadError,O=i.onLoaderStart,D=i.onNetworksChange,W=i.onConfirm,U=i.onCancel,M=i.onShippingAddressChange,B=i.onShippingRateChange,R=te("mounts <".concat(n,">")),x="elements"in R?R.elements:null,b="checkoutSdk"in R?R.checkoutSdk:null,V=l.useState(null),X=ge(V,2),v=X[0],Ee=X[1],k=l.useRef(null),z=l.useRef(null);j(v,"blur",E),j(v,"focus",C),j(v,"escape",L),j(v,"click",G),j(v,"loaderror",g),j(v,"loaderstart",O),j(v,"networkschange",D),j(v,"confirm",W),j(v,"cancel",U),j(v,"shippingaddresschange",M),j(v,"shippingratechange",B),j(v,"change",A);var H;P&&(e==="expressCheckout"?H=P:H=function(){P(v)}),j(v,"ready",H),l.useLayoutEffect(function(){if(k.current===null&&z.current!==null&&(x||b)){var w=null;b?w=b.createElement(e,d):x&&(w=x.create(e,d)),k.current=w,Ee(w),w&&w.mount(z.current)}},[x,b,d]);var ne=Z(d);return l.useEffect(function(){if(k.current){var w=xe(d,ne,["paymentRequest"]);w&&"update"in k.current&&k.current.update(w)}},[d,ne]),l.useLayoutEffect(function(){return function(){if(k.current&&typeof k.current.destroy=="function")try{k.current.destroy(),k.current=null}catch{}}},[]),l.createElement("div",{id:S,className:h,ref:z})},o=function(i){te("mounts <".concat(n,">"));var S=i.id,h=i.className;return l.createElement("div",{id:S,className:h})},c=t?o:s;return c.propTypes={id:p.string,className:p.string,onChange:p.func,onBlur:p.func,onFocus:p.func,onReady:p.func,onEscape:p.func,onClick:p.func,onLoadError:p.func,onLoaderStart:p.func,onNetworksChange:p.func,onConfirm:p.func,onCancel:p.func,onShippingAddressChange:p.func,onShippingRateChange:p.func,options:p.object},c.displayName=n,c.__elementType=e,c},m=typeof window>"u",Ve=l.createContext(null);Ve.displayName="EmbeddedCheckoutProviderContext";var Xe=function(){var e=te("calls useStripe()"),t=e.stripe;return t};f("auBankAccount",m);f("card",m);var ue=f("cardNumber",m),ze=f("cardExpiry",m),He=f("cardCvc",m);f("fpxBank",m);f("iban",m);f("idealBank",m);f("p24Bank",m);f("epsBank",m);f("payment",m);f("expressCheckout",m);f("currencySelector",m);f("paymentRequestButton",m);f("linkAuthentication",m);f("address",m);f("shippingAddress",m);f("paymentMethodMessaging",m);f("affirmMessage",m);f("afterpayClearpayMessage",m);const Qe=()=>{const{items:r}=re(c=>c.cart),e=r.reduce((c,u)=>c+parseFloat(u.sub_total),0),t=e*.1,n=100,s=100,o=e+t+n-s;return a.jsx("div",{className:"col-lg-4 col-12",children:a.jsx("div",{className:"cout-order-area",children:a.jsx("div",{className:"oreder-item",children:a.jsxs("ul",{children:[a.jsxs("li",{className:"o-header",children:["Your Order",a.jsxs("span",{children:["(",r.length,")"]})]}),r.map((c,u)=>a.jsxs("li",{children:[c.product.name," X ",c.quantity,a.jsx("span",{children:parseFloat(c.sub_total).toFixed(2)})]},u)),a.jsxs("li",{className:"s-total",children:["Sub Total",a.jsx("span",{children:e.toFixed(2)})]}),a.jsxs("li",{children:["( + ) VAT",a.jsx("span",{children:t.toFixed(2)})]}),a.jsxs("li",{children:["( + ) Eco Tax",a.jsx("span",{children:n.toFixed(2)})]}),a.jsxs("li",{children:["( - ) Discount Price",a.jsx("span",{children:s.toFixed(2)})]}),a.jsxs("li",{className:"o-bottom",children:["Total price",a.jsx("span",{children:o.toFixed(2)})]})]})})})})},Ze=()=>N.useMemo(()=>({style:{base:{color:"#424770",letterSpacing:"0.025em",fontFamily:"Source Code Pro, monospace","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}),[]),Q={style:{base:{color:"#424770",letterSpacing:"0.025em",fontFamily:"Source Code Pro, monospace","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},et=({selectedAddress:r})=>{const e=Xe(),t=Ke(),n=re(i=>i.cart.id),[s,o]=N.useState(!1),c=pe();Ze();const u=async i=>{var S;if(i.preventDefault(),!r){T.warn("Please select an address");return}if(!e||!t){T.error("Stripe is not loaded");return}o(!0);try{const h=await Y.orderPlace({cart_id:n,address_id:r});if(c(fe()),!h)throw new Error("Order placement failed");const y=h.id,d=await Y.processPayment({order:y,payment_method:"STRIPE"});if(!((S=d==null?void 0:d.data)!=null&&S.client_secret))throw new Error("Payment processing failed");const{client_secret:E}=d.data,C=await e.confirmCardPayment(E,{payment_method:{card:t.getElement(ue)}});if(C.error)throw new Error(C.error.message);C.paymentIntent.status==="succeeded"&&T.success("Payment successful!")}catch(h){T.error(h.message)}o(!1)};return a.jsxs("form",{className:"stripe-form w-100",children:[a.jsx("div",{className:"d-flex w-100",children:a.jsx("img",{src:"assets/img/stripe.png",className:"m-auto",alt:"",style:{maxWidth:"70px"}})}),a.jsxs("label",{children:["Card Number",a.jsx(ue,{options:Q,className:"stripe-card"})]}),a.jsxs("label",{children:["Expiration Date",a.jsx(ze,{options:Q,className:"stripe-card"})]}),a.jsxs("label",{children:["Security Code",a.jsx(He,{options:Q,className:"stripe-card"})]}),a.jsx("button",{onClick:u,disabled:!e||s,className:"theme-btn mt-3",children:s?"Processing...":"Pay with Stripe"})]})},de=Le("pk_test_51PGk1E08B7UPR9midVhC2PlwAYdcEowjTvHEgJS12GRRiZIFq2D9rCzcKKa0xntvKTDDIt6DxtQP6Qyles7FKXQJ00WJYc7wA7"),nt=()=>{const[r,e]=N.useState({address:!0,payment:!1}),[t,n]=N.useState({city:"",state:"",postal_code:"",country:""}),s=re(g=>g.cart.id),[o,c]=N.useState([]),[u,i]=N.useState(),[S,h]=N.useState(!1),[y,d]=N.useState("stripe"),[E,C]=N.useState(!1),P=pe(),A=g=>{e(O=>({...O,[g]:!O[g]}))},L=async()=>{h(!0);try{const g=await we.getAddress();c(g==null?void 0:g.data)}catch(g){console.warn(g)}finally{h(!1)}};N.useEffect(()=>{L()},[]);const G=async g=>{var O,D,W,U,M,B,R;if(g.preventDefault(),!E&&!u){T.warn("Please select an address");return}else try{let x;if(E){const v=await be.post("auth/address/",{...t});x=(O=v==null?void 0:v.data)==null?void 0:O.id}else x=u;const b=await Y.orderPlace({cart_id:s,address_id:x});if(console.log(b),!(b!=null&&b.data))throw P(fe()),new Error("Order placement failed");const V=(D=b==null?void 0:b.data)==null?void 0:D.id;await Y.processPayment({order:V,payment_method:"CASH"})&&T.success("Order Placed Successfully")}catch(x){console.warn(x),T.error(`Failed To place order${((U=(W=x==null?void 0:x.response)==null?void 0:W.data)==null?void 0:U.message)||((R=(B=(M=x==null?void 0:x.response)==null?void 0:M.data)==null?void 0:B.message)==null?void 0:R[0])}`)}};return a.jsx(ee,{stripe:de,children:a.jsx("div",{className:"checkout-area section-padding",children:a.jsx("div",{className:"container",children:a.jsx("div",{className:"checkout-wrap",children:a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-lg-8 col-12",children:[a.jsx(AddreshsList,{address:o,addLoad:S,activeAccordion:r,toggleAccordion:A,isNewAdd:E,setIsNewAdd:C,setSelectedAddress:i,formData:t,setFormData:n}),a.jsx("div",{className:"caupon-wrap s3",children:a.jsx("div",{className:"payment-area",children:a.jsx("div",{className:"row",children:a.jsxs("div",{className:"col-12",children:[a.jsx("div",{className:`coupon coupon-3 ${r.payment?"accordian-border-top":" accordian-border-left "} `,onClick:()=>A("payment"),children:a.jsx("label",{id:"toggle4",children:"Payment Method"})}),r.payment&&a.jsxs("div",{className:"payment-option",children:[a.jsx("div",{className:"payment-select",children:a.jsxs("ul",{children:[a.jsxs("li",{className:"addToggle",children:[a.jsx("input",{id:"stripe",type:"radio",checked:y==="stripe",onChange:()=>d("stripe")}),a.jsx("label",{htmlFor:"stripe",className:"ps-2 me-4 cursor-pointer",children:"Payment By Stripe"})]}),a.jsxs("li",{className:"removeToggle",children:[a.jsx("input",{id:"cash",type:"radio",checked:y==="cash",onChange:()=>d("cash")}),a.jsx("label",{htmlFor:"cash",className:"ps-2 cursor-pointer",children:"Cash On delivery"})]})]})}),y==="stripe"&&a.jsx(ee,{stripe:de,children:a.jsx(et,{selectedAddress:u,cartId:s})}),y==="cash"&&a.jsx("div",{className:"contact-form form-style",children:a.jsx("div",{className:"row",children:a.jsx("div",{className:"col-lg-12 col-md-12 col-12",children:a.jsx("div",{className:"submit-btn-area text-center",children:a.jsx("button",{className:"theme-btn px-5",onClick:g=>G(g),children:"Place Order"})})})})})]})]})})})})]}),a.jsx(Qe,{})]})})})})})};export{nt as default};
